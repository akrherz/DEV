"""Generic plotter"""
import datetime
from calendar import month_abbr

from pyiem.plot.use_agg import plt
from pyiem.plot import MapPlot
from pyiem.network import Table as NetworkTable
from pyiem.util import get_dbconn, drct2text
import numpy as np
from pandas.io.sql import read_sql

data = """ KABQ   | 12768 | 2001-01-10 11:14:00-06 | 2020-03-02 16:01:00-06
 KABR   |  2848 | 2001-01-11 15:34:00-06 | 2020-03-04 16:57:00-06
 KAKQ   | 27284 | 2001-01-05 07:44:00-06 | 2020-03-03 21:39:00-06
 KALY   |  9476 | 2001-02-03 13:50:00-06 | 2020-03-04 20:01:00-06
 KAMA   | 10154 | 2001-01-13 05:06:00-06 | 2020-02-25 16:53:00-06
 KAPX   |  2200 | 2001-01-28 05:18:00-06 | 2020-02-18 09:33:00-06
 KARX   |  6226 | 2001-01-11 04:50:00-06 | 2020-03-05 21:42:00-06
 KBGM   |  8019 | 2001-01-17 14:44:00-06 | 2020-03-03 20:41:00-06
 KBIS   |  7249 | 2001-01-03 16:05:00-06 | 2020-03-06 04:18:00-06
 KBMX   | 15974 | 2001-01-01 06:51:00-06 | 2020-03-04 14:14:00-06
 KBOI   |  1659 | 2001-01-05 14:40:00-06 | 2020-02-23 15:56:00-06
 KBOU   |  3564 | 2001-01-01 11:53:00-06 | 2019-11-29 16:56:00-06
 KBOX   |  9146 | 2001-01-29 04:05:00-06 | 2020-02-26 17:09:00-06
 KBRO   |  4874 | 2001-01-02 17:18:00-06 | 2020-03-04 09:44:00-06
 KBTV   |  4930 | 2001-01-05 03:42:00-06 | 2020-03-02 09:26:00-06
 KBUF   |  7099 | 2001-02-23 14:27:00-06 | 2020-03-03 19:37:00-06
 KBYZ   |  4973 | 2001-01-11 16:00:00-06 | 2020-02-29 16:53:00-06
 KCAE   |  6252 | 2001-01-19 03:00:00-06 | 2020-03-03 16:28:00-06
 KCAR   |  4648 | 2001-01-03 05:15:00-06 | 2020-03-04 17:49:00-06
 KCHS   | 12973 | 2001-01-09 11:48:00-06 | 2020-03-05 15:16:00-06
 KCLE   |  3205 | 2001-01-12 15:38:00-06 | 2020-03-05 21:56:00-06
 KCRP   |  6215 | 2001-01-03 15:38:00-06 | 2020-03-04 08:33:00-06
 KCTP   | 12435 | 2001-01-14 03:19:00-06 | 2020-03-03 21:57:00-06
 KCYS   | 10741 | 2001-01-05 15:41:00-06 | 2020-03-03 09:50:00-06
 KDDC   |  5918 | 2001-01-01 04:00:00-06 | 2020-02-24 19:52:00-06
 KDLH   | 10119 | 2001-01-28 04:15:00-06 | 2020-03-05 17:49:00-06
 KDMX   |  5906 | 2001-01-11 16:23:00-06 | 2020-02-21 12:47:00-06
 KDSM   |   188 | 2002-07-01 05:42:00-05 | 2002-12-18 05:49:00-06
 KDTX   |  7365 | 2001-01-28 04:50:00-06 | 2020-03-06 06:01:00-06
 KDVN   |  8142 | 2001-01-01 04:44:00-06 | 2020-03-04 01:18:00-06
 KEAX   |  8914 | 2001-01-01 06:00:00-06 | 2020-02-17 18:12:00-06
 KEKA   |  1333 | 2001-01-10 19:15:00-06 | 2019-09-18 19:22:00-05
 KEPZ   |  6263 | 2001-01-11 15:58:00-06 | 2020-03-03 16:09:00-06
 KEWX   |  7345 | 2001-01-02 15:43:00-06 | 2020-03-04 07:01:00-06
 KEYW   |   765 | 2002-07-01 05:00:00-05 | 2010-02-12 14:12:00-06
 KFAR   |   857 | 2001-01-03 04:43:00-06 | 2003-03-07 03:50:00-06
 KFFC   | 33854 | 2001-01-01 04:55:00-06 | 2020-03-06 06:26:00-06
 KFGF   |  2804 | 2003-05-30 02:05:00-05 | 2020-03-05 08:26:00-06
 KFGZ   |  1951 | 2001-01-06 16:31:00-06 | 2019-11-20 18:26:00-06
 KFSD   |  1596 | 2001-01-11 15:58:00-06 | 2020-02-14 12:59:00-06
 KFWD   | 15344 | 2001-01-01 05:00:00-06 | 2020-03-04 09:46:00-06
 KGEG   |    68 | 2001-02-14 13:40:00-06 | 2002-04-13 07:00:00-05
 KGGW   |  2301 | 2001-03-31 22:55:00-06 | 2020-02-14 16:20:00-06
 KGID   |  8289 | 2001-01-10 04:30:00-06 | 2020-02-27 12:50:00-06
 KGJT   |  2555 | 2001-01-09 21:15:00-06 | 2020-02-24 10:03:00-06
 KGLD   |  8676 | 2001-01-12 16:51:00-06 | 2020-03-01 22:22:00-06
 KGRB   |  8294 | 2001-01-27 05:00:00-06 | 2020-03-06 03:45:00-06
 KGRR   |  4629 | 2001-01-01 05:00:00-06 | 2019-11-02 10:48:00-05
 KGSP   | 20249 | 2001-01-01 02:55:00-06 | 2020-03-06 03:23:00-06
 KGTF   |   154 | 2001-01-02 06:00:00-06 | 2002-05-21 21:03:00-05
 KGYX   |  7450 | 2001-02-03 11:00:00-06 | 2020-03-03 02:35:00-06
 KHGX   |  4671 | 2001-01-02 10:31:00-06 | 2020-03-04 12:29:00-06
 KHNX   |  4211 | 2001-01-04 17:18:00-06 | 2020-03-01 00:12:00-06
 KHUN   | 12906 | 2003-01-02 11:12:00-06 | 2020-03-06 00:00:00-06
 KICT   | 11424 | 2001-01-15 11:44:00-06 | 2020-02-25 10:16:00-06
 KILM   |  7691 | 2001-01-19 18:00:00-06 | 2020-03-03 16:38:00-06
 KILN   | 10969 | 2001-01-17 05:46:00-06 | 2020-03-04 09:07:00-06
 KILX   |  2742 | 2003-03-08 17:40:00-06 | 2020-03-05 16:03:00-06
 KIND   |  5074 | 2001-01-05 03:56:00-06 | 2020-03-06 04:37:00-06
 KISN   |  1017 | 2001-01-11 23:57:00-06 | 2004-12-15 06:06:00-06
 KIWX   |  7462 | 2001-02-03 14:18:00-06 | 2020-03-03 14:47:00-06
 KJAN   | 17183 | 2001-01-01 05:31:00-06 | 2020-03-04 21:50:00-06
 KJAX   | 30132 | 2001-01-01 05:00:00-06 | 2020-03-05 16:36:00-06
 KJKL   |  8929 | 2001-01-17 15:00:00-06 | 2020-03-06 03:30:00-06
 KKEY   |  2291 | 2001-01-01 04:42:00-06 | 2020-01-31 21:58:00-06
 KLBF   |  7066 | 2001-01-10 15:14:00-06 | 2020-02-17 06:17:00-06
 KLCH   |  6158 | 2001-01-01 08:36:00-06 | 2020-03-04 17:42:00-06
 KLIX   | 12349 | 2001-01-01 09:47:00-06 | 2020-03-04 20:37:00-06
 KLKN   |  4222 | 2001-01-10 06:20:00-06 | 2020-03-05 23:43:00-06
 KLMK   | 16904 | 2001-01-17 14:26:00-06 | 2020-03-06 04:31:00-06
 KLOT   |  5196 | 2001-01-01 05:19:00-06 | 2020-03-05 14:55:00-06
 KLOX   |  2342 | 2001-01-06 16:00:00-06 | 2020-02-01 21:17:00-06
 KLSE   |   205 | 2002-07-01 05:45:00-05 | 2002-12-17 21:32:00-06
 KLSX   |  4965 | 2001-02-09 05:34:00-06 | 2020-01-28 04:19:00-06
 KLUB   |  6709 | 2001-01-12 15:51:00-06 | 2020-02-24 20:02:00-06
 KLWX   |  9209 | 2001-01-04 21:40:00-06 | 2020-02-28 07:34:00-06
 KLZK   |  8852 | 2001-01-01 10:19:00-06 | 2020-03-03 01:37:00-06
 KMAF   | 11307 | 2001-01-01 05:35:00-06 | 2020-03-04 00:00:00-06
 KMEG   | 10731 | 2001-01-17 15:42:00-06 | 2020-03-03 04:33:00-06
 KMFL   | 13652 | 2001-01-01 01:45:00-06 | 2020-03-06 07:31:00-06
 KMFR   |  1751 | 2001-01-23 00:53:00-06 | 2020-01-13 15:55:00-06
 KMHX   |  9232 | 2001-01-09 05:38:00-06 | 2020-03-03 18:07:00-06
 KMKX   |  6018 | 2001-01-12 15:27:00-06 | 2020-03-05 17:48:00-06
 KMLB   | 10553 | 2001-01-01 05:00:00-06 | 2020-03-05 04:55:00-06
 KMLI   |   142 | 2002-07-01 04:51:00-05 | 2002-12-18 08:00:00-06
 KMOB   | 10410 | 2001-01-01 06:05:00-06 | 2020-03-05 03:32:00-06
 KMPX   |  5485 | 2001-01-04 03:45:00-06 | 2020-02-22 03:16:00-06
 KMQT   |  4239 | 2001-01-04 21:40:00-06 | 2020-03-04 14:37:00-06
 KMRX   |  8707 | 2001-01-17 14:19:00-06 | 2020-03-03 09:22:00-06
 KMSO   |  2223 | 2001-03-12 15:00:00-06 | 2020-02-29 22:48:00-06
 KMSP   |   101 | 2002-07-01 03:42:00-05 | 2002-12-05 09:00:00-06
 KMTR   |   930 | 2002-07-08 23:40:00-05 | 2020-01-16 15:57:00-06
 KOAX   |  7145 | 2001-01-10 15:40:00-06 | 2020-03-05 14:10:00-06
 KOHX   |  8648 | 2001-01-01 04:45:00-06 | 2020-03-03 05:07:00-06
 KOKX   |  9066 | 2001-01-05 14:40:00-06 | 2020-03-03 21:59:00-06
 KOMA   |   511 | 2002-07-01 05:15:00-05 | 2002-10-01 22:52:00-05
 KOTX   |   762 | 2002-06-05 16:38:00-05 | 2019-09-26 18:01:00-05
 KOUN   | 27778 | 2001-01-14 05:10:00-06 | 2020-02-24 19:37:00-06
 KPAH   |  7053 | 2001-01-17 06:15:00-06 | 2020-03-02 23:57:00-06
 KPBZ   | 12612 | 2001-01-17 03:31:00-06 | 2020-03-03 20:20:00-06
 KPDT   |  1699 | 2001-02-14 15:30:00-06 | 2020-02-14 14:16:00-06
 KPHI   | 13743 | 2001-01-04 15:08:00-06 | 2020-03-03 20:49:00-06
 KPIH   |  4804 | 2001-01-05 17:09:00-06 | 2020-02-29 15:15:00-06
 KPQR   |  4315 | 2001-01-18 11:21:00-06 | 2020-01-26 22:17:00-06
 KPSR   |  4072 | 2001-01-07 09:48:00-06 | 2020-03-02 18:59:00-06
 KPUB   |  9789 | 2001-01-01 08:00:00-06 | 2020-02-24 14:27:00-06
 KRAH   | 16253 | 2001-01-08 23:50:00-06 | 2020-03-04 04:55:00-06
 KRAP   |    50 | 2002-07-02 05:30:00-05 | 2003-02-05 15:40:00-06
 KREV   |  4435 | 2001-01-05 16:00:00-06 | 2020-03-06 07:22:00-06
 KRIW   | 17065 | 2001-01-12 20:07:00-06 | 2020-03-04 14:55:00-06
 KRLX   | 10803 | 2001-01-01 14:39:00-06 | 2020-03-04 09:20:00-06
 KRNK   | 18787 | 2001-01-18 20:46:00-06 | 2020-03-06 08:48:00-06
 KSAN   |     2 | 2002-08-09 05:05:00-05 | 2004-01-24 06:05:00-06
 KSEW   |  1463 | 2001-01-15 23:22:00-06 | 2020-02-23 08:47:00-06
 KSGF   |  8054 | 2001-01-01 06:00:00-06 | 2020-03-02 21:13:00-06
 KSGX   |  2063 | 2001-01-06 16:00:00-06 | 2020-02-22 14:58:00-06
 KSHV   |  8030 | 2001-01-01 07:10:00-06 | 2020-03-04 13:26:00-06
 KSJT   |  9884 | 2001-01-10 05:40:00-06 | 2020-03-04 13:53:00-06
 KSLC   |  2347 | 2001-01-23 16:00:00-06 | 2019-10-19 16:30:00-05
 KSPI   |  2241 | 2001-01-01 06:08:00-06 | 2002-12-18 19:10:00-06
 KSTL   |   174 | 2002-07-01 06:30:00-05 | 2003-03-24 19:40:00-06
 KSTO   |  4534 | 2001-01-04 23:51:00-06 | 2020-02-28 16:55:00-06
 KTAE   | 10513 | 2001-01-01 05:00:00-06 | 2020-03-05 13:24:00-06
 KTBW   | 10414 | 2001-01-01 03:51:00-06 | 2020-02-26 17:15:00-06
 KTFX   |  5007 | 2001-04-07 05:46:00-05 | 2020-03-04 15:29:00-06
 KTOP   |  6379 | 2001-01-11 15:40:00-06 | 2020-01-15 05:08:00-06
 KTSA   | 15617 | 2001-01-01 06:00:00-06 | 2020-02-18 10:38:00-06
 KTWC   |  2844 | 2001-01-07 04:58:00-06 | 2019-12-09 16:13:00-06
 KUNR   |  6263 | 2001-01-10 05:15:00-06 | 2020-03-04 17:29:00-06
 KVEF   |   427 | 2001-01-05 17:00:00-06 | 2015-12-25 02:45:00-06
 KWAL   |    28 | 2008-07-01 08:53:00-05 | 2008-08-29 22:53:00-05
 KWBQ   |     2 | 2013-12-06 10:13:00-06 | 2013-12-14 22:12:00-06
 KZDV   |     1 | 2002-07-16 07:00:00-05 | 2002-07-16 07:00:00-05
 KZMP   |     1 | 2002-09-28 05:00:00-05 | 2002-09-28 05:00:00-05
 NSTU   |   173 | 2002-09-30 12:00:00-05 | 2020-02-14 14:09:00-06
 PABE   |    61 | 2003-11-26 09:20:00-06 | 2015-01-15 18:26:00-06
 PABR   |    68 | 2001-08-14 17:36:00-05 | 2009-09-05 23:32:00-05
 PACD   |    13 | 2003-10-29 03:33:00-06 | 2006-05-12 07:54:00-05
 PADQ   |    21 | 2004-01-25 15:37:00-06 | 2014-03-13 22:55:00-05
 PAFA   |    49 | 2001-01-02 18:49:00-06 | 2001-02-08 13:10:00-06
 PAFC   |  1315 | 2001-04-19 12:30:00-05 | 2020-03-02 07:34:00-06
 PAFG   |  1904 | 2001-02-08 13:33:00-06 | 2020-02-28 17:30:00-06
 PAJK   |  1042 | 2003-12-23 04:00:00-06 | 2020-02-17 20:31:00-06
 PAJN   |    36 | 2001-03-18 18:10:00-06 | 2003-11-10 13:00:00-06
 PAKN   |    19 | 2003-11-26 08:30:00-06 | 2011-02-08 20:29:00-06
 PAMC   |    42 | 2003-11-07 11:43:00-06 | 2010-11-24 19:21:00-06
 PANT   |    47 | 2001-01-04 22:36:00-06 | 2007-06-03 04:00:00-05
 PAOM   |    64 | 2005-08-29 09:27:00-05 | 2015-02-24 11:43:00-06
 PAOT   |    13 | 2004-11-13 04:49:00-06 | 2015-05-15 10:15:00-05
 PASN   |    45 | 2003-06-11 09:09:00-05 | 2006-09-14 05:00:00-05
 PAVD   |     5 | 2002-09-03 01:29:00-05 | 2003-12-04 20:22:00-06
 PAVW   |    34 | 2003-02-25 04:20:00-06 | 2012-09-14 19:21:00-05
 PAYA   |    28 | 2002-11-05 22:50:00-06 | 2011-11-28 17:57:00-06
 PGUM   |  1527 | 2001-06-28 22:28:00-05 | 2019-12-21 20:28:00-06
 PHFO   |   438 | 2001-04-12 20:43:00-05 | 2020-02-26 08:07:00-06
 SABM   |     1 | 2004-05-08 22:36:00-05 | 2004-05-08 22:36:00-05
 TJSJ   |  3082 | 2001-10-17 05:30:00-05 | 2020-03-06 06:56:00-06"""


def main():
    """Go Main"""
    vals = {}
    for line in data.split("\n"):
        wfo, count, sts, ets = line.strip().split("|")
        wfo = wfo.strip()
        wfo = wfo[1:]
        if wfo == "JSJ":
            wfo = "SJU"
        vals[wfo] = float(count) / 19.0
    bins = [1, 25, 100, 250, 500, 750, 1000, 1500, 2000]
    # bins = np.arange(2011, 2021, 1)
    cmap = plt.get_cmap("hot")
    mp = MapPlot(
        sector="nws",
        continentalcolor="white",
        figsize=(12.0, 9.0),
        title=(
            "2001-2019 NWS SPS Text Products Issued per Year by Forecast Office"
        ),
        subtitle=("based on IEM archives"),
    )
    mp.fill_cwas(
        vals,
        bins=bins,
        lblformat="%.0f",  # , labels=labels,
        cmap=cmap,
        ilabel=True,  # clevlabels=clevlabels,
        units="Count / Year",
        spacing="proportional",
    )

    mp.postprocess(filename="test.png")


if __name__ == "__main__":
    main()
